\documentclass[class=minimal,border=0pt]{standalone}
\usepackage{../tumcolor}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=newest}
\usetikzlibrary{pgfplots.groupplots}
\pgfplotsset{grid style={dotted}}
\usetikzlibrary{plotmarks}

\pgfplotsset{
    mark repeat*/.style={
        scatter,
        scatter src=x,
        scatter/@pre marker code/.code={
            \pgfmathtruncatemacro\usemark{
                (\coordindex==(\numcoords-#1)
            }
            \ifnum\usemark=0
                \pgfplotsset{mark=none}
            \fi
        },
        scatter/@post marker code/.code={}
    }
}

\begin{document}
%\pgfplotsset{
%    every non boxed x axis/.style={} 
%}
\tikzset{every mark/.append style={scale=1.2}}
\begin{tikzpicture}
\begin{axis}[
	width=10cm,
	height=6cm,
	x dir=reverse,
	xmode=log,
	xmin=0, xmax=1,
	ymin=0, ymax=240,
	grid=major,
	xlabel={Percentile},
	xtick={1, 0.1, 0.01, 0.001, 0.0001, 0.00001, 0.000001, 0.0000002},
	minor xtick={.9, .8, .7, .6, .5, .4, .3, .2, .09, .08, .07, .06, .05, .04, .03, .02, .009, .008, .007, .006, .005, .004, .003, .002, .0009, .0008, .0007, .0006, .0005, .0004, .0003, .0002, .00009, .00008, .00007, .00006, .00005, .00004, .00003, .00002, .000009, .000008, .000007, .000006, .000005, .000004, .000003, .000002},
	xticklabels={0, 90, 99, 99.9, 99.99, 99.999, {}, Max},
	ylabel={Latency [$\mu$s]},
	every axis legend/.append style={nodes={right}},
	legend entries={C, Rust, Go},
	legend pos = north east
]
\addplot [mark=none,color=TUMBlack, thick] table[col sep=comma,y=lat,x expr=1-\thisrow{cdf}] {c-cdf.csv};
\addplot [mark=none,color=TUMDarkerBlue, thick] table[col sep=comma,y=lat,x expr=1-\thisrow{cdf}] {rust-cdf.csv};
\addplot [mark=none,color=TUMGreen, thick] table[col sep=comma,y=lat,x expr=1-\thisrow{cdf}] {go-cdf.csv};

%\addplot [mark=diamond*,color=TUMYellow, thick,mark repeat*=4] table[col sep=comma,x=lat,y expr=1-\thisrow{cdf}] {ocaml-cdf.csv};
%\addplot [mark=*,color=TUMLightRed, thick,mark repeat*=2] table[col sep=comma,x=lat,y expr=1-\thisrow{cdf}] {haskell-cdf.csv};
%\addplot [mark=pentagon*,color=TUMPurple, thick,mark repeat*=2] table[col sep=comma,x=lat,y expr=1-\thisrow{cdf}] {swift-cdf.csv};
%\addplot [mark=none,color=TUMIvony, thick,mark repeat*=2] table[col sep=comma,x=lat,y expr=1-\thisrow{cdf}] {python-cdf.csv};

\addplot[mark=none,color=black!60,forget plot,dashed,thick] coordinates {
(0,0.01)
(200,0.01)
};
\addplot[mark=none,color=black!60,forget plot,dashed,thick] coordinates {
(0,0.0001)
(200,0.0001)
};
\addplot[mark=none,color=black!60,forget plot,dashed,thick] coordinates {
(0,0.000001)
(200,0.000001)
};
\node[anchor = south,yshift=-0.2em] at (axis cs: 100,0.01) { 99th percentile};
\node[anchor = south,yshift=-0.2em] at (axis cs: 100,0.0001) { 99.99th percentile};
\node[anchor = south,yshift=-0.2em] at (axis cs: 100,0.000001) { 99.9999th percentile};
\end{axis}
\end{tikzpicture}
\end{document}
